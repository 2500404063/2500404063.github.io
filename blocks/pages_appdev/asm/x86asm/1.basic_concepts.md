# 基础概念

## CPU的事情
一台计算机是一个状态机，只具有储存状态，修改状态，运算的功能。
内存负责储存数据
CPU负责解读指令，和其他硬件（内存芯片，硬盘芯片，显卡芯片，USB芯片，以太网芯片）进行交互。

所以CPU的事情其实就很"简单"：
1. 读取指令
2. 识别指令
3. 执行指令

## CPU和储存器的交互过程
CPU需要和硬盘(ROM)进行交互，以读取可断电储存的指令。
CPU需要和内存(RAM)进行交互，以储存临时产生的数据（状态）。
CPU和储存器交互需要三条总线：
1. 地址总线
2. 数据总线
3. 控制总线

为什么需要这三条呢？因为对储存器就是这么设计的，需要三个控制信号，所以需要这三条。

### 地址总线
一条地址总线可以表示0或者1，这条总线上挂着储存器的引脚。
如果有10根地址总线，则可以寻址的大小为：2^10=1024，一共1024种，范围[0,1023]

### 数据总线
和地址总线的概念类似，数据总线的数量表示一次性最多可以传输多少个bits
对于8位CPU来说，一次传输可以传输1个字节

### 控制总线
为什么要先说数据总线呢？
因为为了保证传输的正确性，需要先保证数据放到数据总线上，和目标地址放到地址总线上，再启动传输。
控制总线就是这个作用。

CPU对储存器有多少种控制就有多少条控制总线，
读，有读数据总线，
写，有写数据总线，
每个都是写1有效或者0有效（由内存芯片决定）
为什么不只用一条线呢？
如果只用一条线，那每时每刻一定会有有一种状态，这样就不符合，先准备好数据，或者准备好地址再开启传输了，会导致传输不可靠。

## CPU和其他硬件的沟通
我们上面说了，CPU的地址总线的条数（宽度）表达了CPU可以指向多少个地址单元。
**这个地址，并不是全部都是指向内存。**
主板上的每一个外设（显卡，硬盘ROM，USB，网卡）都连接着CPU的地址总线上，都有自己的地址。

**CPU在操作其他外设的时候均把它们当作储存器来对待。**
具体的功能由这些外设的芯片来实现。

## 地址是怎么确定的
64位的CPU，地址总线也就64根，所以不可能每一个储存单元都分配一个地址。
所以，这64根，可以表示2^64个数字，这些数字足够庞大，每一个数代表一个地址。
所以这么多数字，CPU怎么知道哪些是哪些芯片？
外设的地址是由外设自己决定的，是遵循规范的。
但是地址因为是一个线性空间，所以可以经过操作系统的映射，改变地址空间的分布，以避免更换硬件后软件失效，提高硬件移植性。
所以地址是由外设硬件和操作系统共同决定的。

## 段地址和偏移地址
把一段地址0000h - 1FFFh，作为一个段。
段地址就是一个段的起始地址，即上述的0000h
如果要访问0010h，就是0000h+10h，这种偏移思想经常用到。
