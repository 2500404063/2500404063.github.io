# 网络层
在网络层定义了很多的底层协议。
网络层决定数据在网络中的**传输路径**，**数据路由**（决定数据在网络的路径）
本节我们要讲述：
1. IP(Internet Protocol)网际协议
2. ARP(Address Resolution Protocol)地址解析协议
3. ICMP网际控制报文协议
4. IGMP网际管理协议
5. 子网划分

![network_layer](./pages_appdev/network/res/network_layer.png)

## IP协议
我们平时接触最多的是IP，就是类似于192.168.1.1这种东西。
IP地址的格式：255.255.255.255  四个字节。
IP地址被划分成不同的类型，以用于不同的功能。
![ipaddress](./pages_appdev/network/res/ipaddress.png)

IP地址具有局域网和广域网IP地址的区分。
广域网IP地址是全球唯一的，而局域网的IP地址对于不同的局域网是可以重复的。
**IP是无连接协议，知道IP地址后，就可以给目标IP发送数据。**

### IP数据报的格式
![ip_packet](./pages_appdev/network/res/ip_packet.png)
从图中可见IP数据报的头结构包含了许多的信息，其中最重要的是**源地址**和**目的地址**，标识了这个数据包的来源和去向。
**版本：**表明IP地址的类型，IPv4还是IPv6
**首部长度：**表示IP头的长度，因为IP头是可变长度，所以用这个来指示IP数据帧的头部的长度。
**区分服务：**一般不用
**总长度：**IP头和数据的总长度
这里还有一个概念，MTU（Maximum Transfer Unit）最大传输单元。
这个标识了链路层所支持的最大一次传输长度（即一个帧的最大总长度），一般是1500，单位是字节。

**标识：**当数据包的总长度大于MTU的时候，就必须要对数据进行分片。该字段表示数据包的ID，占16位。
例如，当一个包被分成两个帧的时候，这两个包具有相同的**标识**，当两个包没有被分片的时候，具有不同的标识。

**标志(flag)：**占3位，但是只有2位有意义。
0位：MF(More Fragment)，为1表示后面还有分片，为0表示当前包已经是分片的最后一个包了。
1位：DF(Don't Fragment)，为1表示该包不能分片，为0表示该包能分片。
2位：无意义

**片偏移：**表示当前分片的包，在整个数据包当中的位置。片偏移以8个字节为偏移单位，即为1时候，相当于在整个数据包中的第八个字节的位置。

**生存时间：**TTL(Time to Live)指明了该数据帧在网络中的生存时间。设置这个的目的是为了避免，有些数据包在网络中找不到位置，结果就一直在网络中弹来弹去。设置一个存活时间，当超过该时间，就直接丢弃该包。在老的IP协议当中，每隔一段时间会将这个值减小1，直到为0为止，现在表示每经过一个路由就减一，所以现在TTL的含义应该是**跳数限制**，因为历史原因，保留了原称呼。

**协议：**定义了该IP数据报的协议。这里需要知道的是，IP协议是一个比较底层的协议，在IP协议的基础之上，建立了很多其他的协议。
例如，协议名(值)：ICMP(1)，IGMP(2)，IP(4)，TCP(6)，EGP(8)，IGP(9)，UDP(17)，IPv6(41)，ESP(50)，OSPF(89)

## ARP协议
在网络层，我们定位网络设备的方法是通过IP地址来定位。
但是实际上，传输信号要通过网卡这些硬件设备来传输，这些设备只认识MAC地址。
ARP协议的作用就是实现了IP地址转换成MAC地址。
还有一个协议叫做RARP，就是反ARP协议，实现MAC地址转IP地址，但是现在已经不用了。

如下图，表示了IP地址和MAC地址的关系。
![ip_mac](./pages_appdev/network/res/ip_mac.png)