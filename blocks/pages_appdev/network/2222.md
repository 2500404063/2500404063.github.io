# NAT

## 什么是Nat

NAT（Network Address Translation，网络地址转换）
Nat的原理就是修改IP和端口。

## 应用

根本目的就是让广域网IP和局域网IP进行映射。
举个例子：
当你去上网的时候，你的局域网IP为：192.168.0.2 随机生成的通讯端口为：1234
那么，你的路由器会将这个IP和端口进行转换，比如转换成：30.0.0.1:4567(由路由器来生成)
那么，服务端看到的IP和端口其实是30.0.0.1:4567。
当服务端返回数据，是返回给30.0.0.1:4567，当你的路由器收到数据，
查询Nat映射表，再把数据发送给192.168.0.2:1234

原理很简单，说白了就是你的局域网IP和广域网IP的端口进行一个绑定。
用这种方式来解决IPv4不够的问题，让多台电脑同时使用同一个广域网IP

## 端口映射

根据Nat，路由器的Nat映射表只能由本地电脑访问其他服务端的时候才能生成。
即，如果你不去访问服务端，那么上面的那个30.0.0.1:4567 - 192.168.0.2:1234的映射表就不会生成。
那么，非局域网内的人访问30.0.0.1:4567，访问到的其实是空的IP和端口，这个数据包会被丢弃。
那么，端口映射的作用其实就是为了解决这个问题。
端口映射后，使得30.0.0.1:4567 - 192.168.0.2:1234这个映射表长期存在，不会因为断开连接而丢失。
这条映射的IP和端口由你自己决定。相当于手动Nat。

### 端口映射存在的问题

大家会想，既然有端口映射这么好的方法！那我就可以让别人访问我的电脑，和其他小伙伴一起联机了！
是，理论可行。但是现实情况是，你的路由器的Wan口，分配到的并不是广域网IP，而也是一个局域网IP。
意思就是，你在你的路由器进行端口映射，你映射出去的还是一个局域网IP，还是没办法和小伙伴联机。
除非你把每一层的路由器或者交换机都进行端口映射，直到映射到广域网IP上才可以。

## 内网穿透

既然端口映射在现实生活中的大多数情况下都太可行，怎么办呢？
那么就得依靠一个，具有广域网IP的服务器，来帮助你将你的数据进行转发。
就是你和你的小伙伴，都连接到同一个服务器上，然后你们的通讯方式是，
先发给服务器，服务器再帮你转发给你的小伙伴。
这样的方式虽然可以实现内网穿透，但是网速会受到服务器的速度限制。
