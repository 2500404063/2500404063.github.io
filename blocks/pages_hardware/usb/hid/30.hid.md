# Main Item
### Input，Output，Feature
input item、output item和feature item描述由一个或多个物理控件提供的**数据的信息**。
应用程序可以**使用此信息来解释设备提供的数据**。
单个item中定义的**所有数据字段共享相同的数据格式**。

input item、output item和feature item有8位，就是上文当中所讲的Item的结构。
其二进制值为 1000 00nn，其中nn可为00，01，10或11，分别表示后跟0字节，1字节，2字节和4字节的数据。

Bit 0 {Data (0) | Constant (1)}：指示项目是数据还是常量值。 数据表示该项目正在定义包含可修改设备数据的报告字段。 常量表示该项目是报表中的静态只读字段，主机无法修改（写入）。

Bit 1 {Array (0) | Variable (1)}：指示项目是在报告中**创建变量**还是**数组数据字段**。
**在变量字段中**，每个字段代表来自物理控件的数据。为每个字段保留的位数由前面的报告大小/报告计数项目决定。
例如，一组八个开/关开关可以在由变量输入项声明的 1 个字节中报告，其中每一位代表一个开关，开 (1) 或关 (0)（报告大小 = 1，报告计数 = 8）。
或者，变量 Input 项可以添加 1 个报告字节，用于表示四个三位按钮的状态，其中每个按钮的状态由两位表示（Report Size = 2, Report count = 4）。
或者来自变量输入项的 1 个字节可以表示操纵杆的 x 位置（报告大小 = 8，报告计数 = 1）。

**数组**提供了一种替代方法来描述从一组按钮返回的数据。数组更有效，比可变项目不那么灵活。
数组不是为组中的每个按钮返回一个位，而是返回与按下的按钮对应的每个字段中的索引（如键盘扫描代码）。
数组字段中的超出范围的值被视为未声明任何控制。
数组中同时按下的按钮或键需要在多个字段中报告。因此，数组输入项（报告计数）中的字段数决定了可以报告的同时控制的最大数量。
使用具有三个 8 位字段的数组（报告大小 = 8，报告计数 = 3），键盘最多可以同时报告三个键。
逻辑最小值指定数组返回的最低索引值，逻辑最大值指定最大值。
可以通过检查差异来推导出数组中的元素数介于逻辑最小值和逻辑最大值之间（元素数 = Logical Maximum -Logical Minimum + 1）。

Bit 2 {Absolute (0) | Relative (1)}
指示数据是绝对数据（基于固定原点）还是相对数据（指示上次报告的值变化）
鼠标设备通常提供相对数据，而平板电脑通常提供绝对数据。

Bit 3 {No Wrap (0) | Wrap (1)}
指示当达到极高或极低值时数据是否“翻滚”。例如，可以自由旋转360度的刻度盘可能输出0到10之间的值。
如果指示“环绕”，则在递增方向上通过10位置后报告的下一个值将为0。

Bit 4 {Linear (0) | Non Linear (1)}
表示来自设备的原始数据是否经过某种方式处理，不再代表测量的数据与报告的数据之间的线性关系。
加速度曲线和操纵杆死区是此类数据的示例。灵敏度设置会影响单位项目，但数据仍将是线性的。

Bit 5 {Preferred State (0) | No Preferred (1)}
指示控件是否具有**在用户未与控件进行物理交互时**将**返回首选状态**。
按钮（与切换按钮相反）和操纵杆的自动对中是示例。

Bit 6 {No Null position (0) | Null state(1)}
指示控件是否处于**不发送有意义数据的状态**。
空状态的一种可能用途是用于需要用户与控件进行物理交互才能使其报告有用的数据。
例如，一些操纵杆有一个多向开关（帽子开关）。
当没有按下帽子开关时，它处于空状态。 当处于空状态时，控件将报告指定的逻辑最小值和逻辑最大值之外的值（最负值，例如 -128 表示 8 位值）。

- Bit 7 Reserved (0) 保留

Bit 8 {Bit Field (0) | Buffered Bytes (1)}
指示控件发出固定大小的字节流。数据字段的内容由应用程序决定。缓冲区的内容不会解释为单个数字量。
由缓冲字节项定义的报表数据必须在8位边界上对齐。来自条形码阅读器的数据就是一个例子
- Bit 31-9 Reserved (0) 保留

> 注意：
> 如果输入项是数组，则只有数据/常量、变量/数组和绝对/相对属性适用。

FeautreItem定义设备的配置选项，通常由控制面板应用程序设置。
因为它们会影响设备的行为（例如，按钮重复率、重置原点等），所以功能项通常对软件应用程序不可见。
相反，输出项表示设备输出给用户（例如，LED、音频、触觉反馈等）。软件应用程序可能会设置设备输出项。

FeautreItem可以是其他项的属性。例如，原点重置功能可应用于一个或多个位置输入项。
与输出项一样，要素项构成了可通过控制管道访问的要素报告，其中包含Get_report（feature）和Set_report（feature）请求

### Collection和End collection
collection和end collection是与数据无关的。
collection item标识两个或多个数据（input、output或feature）之间的关系。
例如，鼠标可以描述为两到四个数据（x、y、按钮 1、按钮 2）的collection。
当 Collection 项打开一个数据集合时，End Collection 项关闭一个集合.

**physical collection-0**
物理集合用于表示在一个几何点收集的数据点的**一组数据项**。
这对于可能需要将测量或感测数据集与单个点相关联的感测设备很有用。
它并不表示一组数据值来自一个设备，例如键盘。
在报告多个传感器位置的设备的情况下，物理集合用于显示哪些数据来自每个单独的传感器。

**Application collection-1**
应用程序是最熟悉的一组主要项目。它可以用于识别单个设备中服务于不同目的的项目组。
常见的例子是键盘或鼠标。带有集成指针设备的键盘可以定义为两个不同的应用程序集合。
数据报告通常（但不一定）与应用程序集合相关联（每个应用程序至少有一个报告 ID）。

**Logical collection-2**
当一组数据项形成**复合数据结构**时，将使用逻辑集合。
一个例子是数据缓冲区和数据字节数之间的关联。集合建立计数和缓冲区之间的链接。

**Report collection-3**
定义一个包含报表中所有字段的逻辑集合。
此集合中将包含唯一的报告 ID。应用程序可以轻松确定设备是否支持某个功能。
请注意，可以为报告集合声明任何有效的报告 ID 值。

**Name dArray collection-4**
命名数组是包含选择器用法数组的逻辑集合。对于给定的功能，类似设备使用的选择器集可能会有所不同。
在记录硬件寄存器时，字段的命名是常见的做法。
要确定设备是否支持特定功能（如状态），应用程序可能必须先查询几个已知的状态选择器用法，然后才能确定设备是否支持状态。
Named Array 用法允许对包含选择器的 Array 字段进行命名，因此应用程序只需查询 Status 用法即可确定设备支持状态信息。

**Usage Switch collection-5**
Usage Switch 是一个逻辑集合，用于修改它所包含的用法的含义。
此集合类型向应用程序指示在此集合中找到的用法必须是特殊情况。
例如，不是在 LED 页面上为每个可能的功能声明用法，而是可以将指标用法应用于 Usage Switch 集合，并且该集合中定义的标准用法现在可以识别为函数的指标，而不是函数本身。
请注意，此集合类型不用于标记 Ordinal 集合，为此使用逻辑集合类型。

**Usage Modifier collection-6**
修改附加到包含集合的用法的含义。用法通常为控件定义单一操作模式。
使用修饰符允许扩展控件的操作模式。
例如，LED 通常是打开或关闭的。对于特定状态，设备可能需要一种通用方法来闪烁或选择标准 LED 的颜色。 将 LED 用法附加到 Usage Modifier 集合将向应用程序表明该用法支持新的操作模式。

**0x07-0x7f**
保留，为将来扩展

**0x80-0xff**
厂商自定义集合

## 代码对照表
![hid_report_descr_main](./pages_hardware/usb/res/hid_report_descr_main.png)