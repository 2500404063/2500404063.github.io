# PCB设计思想
PCB类型：普通电路板，高频信号电路板，小信号电路板。
知道了不同类型的电路板的要求，就知道要优化什么。
https://uinika.gitee.io/Electronics/PCB/

## 信号完整性问题
**信号完整性（SI，Signal Integrity）**是指 PCB 上的信号经由信号线传输以后仍然能保持完整与正确，当电路中的信号能够以正确的时序、符合要求的持续时间与电压幅度进行传送，并完整的到达输出端时，即说明该电路具有良好的信号完整性；而当信号不能正常响应时，就认为出现了信号完整性问题，特别是在高频高速电路当中。因此，信号完整性分析的目的就是为了确保信号的时序与电压幅度正确传输，电路设计当中常见的信号完整性问题主要集中在如下几个方面：

1. 传输延迟（Transmission Delay）：指信号没有在规定的时间内以一定的持续时间和幅度到达接收端，通常是由于驱动过载、布线过长的传输线效应引起。此外，传输线上的电容、电感也会对信号的状态切换产生延时。高速电路设计当中，传输延迟是一个无法回避的问题，因此专门引入了一个延迟容限的概念，即确保电路正常工作的前提下，所允许的信号最大时序变化。
2. 反射（Reflection）：指传输线上的回波，信号功率的一部分从源端经过传输线传递至负载，另一部分则会向源端反射。高速电路设计当中，可以将导线等效为传输线，而非集总参数电路中的导线。若阻抗匹配(源端阻抗、传输线阻抗、负载阻抗三者相等)则反射不会发生；反之，如果负载阻抗与传输线阻抗不匹配就会导致接收端向源端的信号反射。布线的几何形状、不恰当的端接方式、经过连接器的传输及电源平面不连续等因素均会导致该问题，进而导致传送信号出现严重的过冲（Overshoot）或下冲（Undershoot）现象，并最终造成信号的波形变形与时序混乱。
3. 窜扰（Crosstalk）：指没有电气连接的信号线之间的感应电压与电流所导致的电磁耦合，这种耦合会造成信号线产生类似天线的作用。其中，容性耦合会引发耦合电流，感性耦合则会引发耦合电压，并伴随时钟速率的提升与 PCB 尺寸的缩小而加大，一切都是由于信号线上有交变的信号电流通过所产生的磁场，处于该磁场中的其它信号线就会感应到信号电压。PCB 的工作层的参数、信号线间距、驱动与接收端的电气特性、信号线本身的端接方式等等都会对窜扰造成一定影响。
4. 接地反弹（Ground Bounce）：指由于电路中由于较大电流涌动而在电源与接地平面之间产生的大量噪声，例如大量芯片同步进行切换时，就会在与电源平面之间产生较大的瞬时电流，而芯片封装与电源之间的寄生电感、电容、电阻就会随之引发电源噪声，造成电路在零电位上产生较大的电压波动，进而影响其它元器件的正常工作。
> 注意：信号完整性问题往往与电磁兼容性问题相伴而生。

## 3W/20H/55 原则
1. 3W 原则：也称为 3H 原则，保证两条走线的中心间距大于 3 倍的线宽，从而减小走线之间的串扰；当走线间的中心距离大于 3 倍线宽时，可以保持 70% 的线间电场不会互相干扰；如要希望达到 98% 的线间电场不互相干扰，则可以使用 10W 规则；
2. 20H 原则：多层 PCB 的边缘会向外辐射电磁干扰，让电源平面尺寸相对地平面尺寸内缩相互间距的 20 倍尺寸，让电场只在接地层范围内进行传导，从而有效抑制这种边缘辐射效应；内缩 20H 则可以将 70% 的电场限制在接地层，内缩 100H 则可以限制 98% 的电场；
3. 55 原则：时钟频率达到 5MHz 或者脉冲信号的上升时间小于 5ns，那么 PCB 必须采用多层板；有时出于成本因素的考虑采用双层板结构，这种情况下最好将 PCB 其中一层作为完整的地平面层；

## PCB 布局规范
1. 电源与信号要分开；
2. 信号的输入与输出要分开；
3. 数字部分与模拟部分要分开；
4. 高频部分与低频部分要分开；
5. 强电部分与弱电部分要分开。

## 元件布局基本原则
1. 通常条件下，所有元件均应分布在 PCB 的相同面上，只有在 PCB 顶层元件过密时，才将一些高度有限并且发热量较小的贴片元件放置在底层；
1. 依据【先大后小，先难后易】的布线原则，重要的单元电路、核心元器件需要首先进行布局，并且保持关键信号线最短；
1. 高电压大电流信号与小电流低电压信号完全分开；模拟信号与数字信号分开；高频信号与低频信号分开，并且高频元器件的隔离要充分；
1. 布局过程当中，充分参考原理框图，根据主信号流向摆放主要元器件；
1. 元件的布局应当便于信号流通，并让信号尽可能保持一致的流动方向；
1. 保证电气性能的前提下，元件应当放置在相互平行或者垂直排列的栅格上，以求整齐美观；
1. 如果元件或导线之间存在较高的电位差，应当加大其间隔距离，避免由于放电击穿引起意外短路；
1. 带有高电压的元件应当尽量布置在调试时，手不容易触及的地方；
1. 位于 PCB 边缘的元件，距离边缘至少要有 2 个板厚的距离；
1. 相同类型的插装元件应当同方向进行放置，同类型的有极性元件也尽量朝相同方向摆放，便于后期生产检测；
1. 避免不同金属封装的元件相互接触；
1. 元件之间的间隔距离需要满足操作空间的要求，例如插拔 TF 卡；
1. 重量较大的元件，应当安装在靠近 PCB 支承点的位置，减小 PCB 板材受力的翘曲度；必要时还应当采取固定措施，不能仅依靠引脚焊面固定；
1. 高压元器件和低压元器件之间保持较宽的电气隔离带，即不将电压等级相差较大的元器件摆放在一起，既有利于电气绝缘，也可以隔离信号提升抗干扰能力；

## 防止电磁干扰
1. 电磁辐射较强的元件，或者对于电磁辐射较为敏感的元件，应加大相互之间的距离或者添加屏蔽罩，元件摆放的方向应当与相邻的铜泊导线交叉；
1. 对于变压器、扬声器、电感等会产生磁场的元件，布局时应注意减少磁力线对于印制导线的切割，相邻元件磁场方向应相互垂直，减少彼此之间的耦合；
1. 电感器件不要近距离并排摆放，避免形成互感；
1. 对电磁干扰源进行屏蔽，并且保证屏蔽罩能够良好的接地；
1. 对于高频电路，需要考虑元件之间的分布参数的影响；

## 抑制热干扰
1. 发热元件优先安排在利于散热的位置，必要时可以单独设置散热片、散热风扇；
1. 一些功耗大的集成块、大或中功率管、电阻等元件，要布置在容易散热的地方，并与其它元件隔开一定距离。
1. PCB 双面都摆放元件时，底层一般不放置发热元件；
1. 电阻、电容、晶振等热敏元件，应当尽量远离高温区域，以避免受到热干扰；
1. 热敏器件尽量摆放在上风口，高元件放置在矮元件后面，并且沿风阻最小的方向放置，避免风道受阻；
1. 采用大面积的接地铜箔，提升 PCB 的散热效率；
1. 接地安装孔可以采用较大的焊盘，以充分利用安装螺栓和 PCB 两侧的铜箔进行散热；

## 电源布局
1. 多采用星形拓扑结构，少采用菊花链布局，缩短电源的公共回路；
1. 电源的输入与输出要分开进行布局，以避免串扰问题；
1. 电源管理芯片、背光芯片、升压芯片需要放置在屏蔽壳当中；
1. 电源走线要尽量避开射频区域；

## 高速元件与天线布局
1. DDR、SDRAM、NAND Flash 等存储芯片需要靠近 CPU 进行摆放，并尽量减少线长以及交叉线的数量；
1. 屏幕插座应当顺着 CPU 出线的方向，中间的 RC 滤波器尽量摆放在 CPU 一侧；
1. 高速器件 CPU、液晶屏幕插座等应当远离天线模块；
1. 射频模块和天线周边不要有金属元器件，以避免影响天线的频率点、阻抗等参数；

## PCB 布线原则
1. 高速信号的走线要尽可能短和直，走线间距要足够大，并且尽量靠近 PCB 边缘或者接插件；
1. 相同信号传输线的线宽需要保持一致，拐线时同样需要保持相同的线宽；
1. 重要的信号线可以增加线宽，以降低其特性阻抗；
1. 关键信号线可以采用平行地线的方式进行隔离；
1. 相邻的两层之间，走线采用 # 字型错开布线；
1. 每条走线的宽度与元器件每个引脚的焊盘连接保持对称，并且从元件焊盘中心位置出线；
1. 当和焊盘连接的走线比焊盘宽时，走线不能覆盖焊盘，应从焊盘末端引线；
1. 引脚间距较为密集的贴片元件焊盘引脚，需要从焊盘外部走线进行连接，不允许直接连接引脚之间的焊盘；
1. 过孔可能会引发信号传输线的阻抗突变，因此需要尽量减少过孔使用的数量；
1. 信号传输线上避免出现桩线，如果无法避免，那么桩线的长度应小于信号的上升时间，避免出现反射；
1. 高速信号走线换层时，附近要有接地孔提供回流环路，确保整板回环小阻抗小；
1. 模拟信号不要使用 EDA 工具的自动布线功能；
1. 对敏感节点使用屏蔽线，即在受干扰结点的周边添加一组屏蔽线，并且在屏蔽线上放置多个接地过孔；

## 串扰
1. **反向电流平行走线**带来的串扰较大；
1. 串扰强度与走线**长度**成正比，与**间距**成反比，与**频率**成正比；
1. 加大走线的间距，缩小走线的平行长度，必要时可以采用 Jog-Out 凹凸布线；
1. 加入端接匹配可以降低反射，并且减小串扰；
1. 将信号层限制在高于接地平面 10mil 范围以内；
1. 向串扰比较严重的两条线之间插入一条地线进行隔离，从而减小串扰；
1. **避开噪声源**，例如 MCU、电感、晶振邻近的表层严禁走线或者打过孔；

## 覆铜
1. PCB 设计当中，没有布线的区域最好选择一个较大的**接地平面**来进行覆盖，以提供屏蔽和提高去耦能力；
1. 发热元件周围或者大电流走线应当尽量避免使用大面积铜箔，长时间受热会导致铜箔膨胀脱落；
1. 发热元件周围如果必须使用大面积铜箔，那么最好采用**栅格覆铜**，便于释放铜箔的表面张力；
1. 相同层的走线分布不平衡或者不同层的铜分布不对称时，推荐覆铜设计。
1. PCB 最外层如果存在大面积的区域没有走线，建议在该区域内栅格覆铜，使得 PCB 整体的铜箔分布均匀；
1. 推荐铺铜网格之间**空白方格**的大小约为 `25mil x 25mil`；
1. 噪声敏感的电路需要考虑接地屏蔽，即在信号层的四周布宽度大于 `50mil` 地线或间距小于 `300mil` 的地孔；
1. 孤铜（特别是表层）超过 `150mils` 时，不能打接地过孔，需要删除该区域，以免形成悬空的天线；

## 参考文献

[1] PCB基本设计规范，Hank，https://uinika.gitee.io/Electronics/PCB/