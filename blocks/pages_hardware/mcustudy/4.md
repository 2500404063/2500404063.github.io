# Timer

## Timer的两种模式

`计时器` 和 `计数器`

**计数器：**
计数器顾名思义，就是可以累计次数。每次收到一次累加信号，就加1.
计数器的信号源来自于外部的输入（引脚）
**计时器：**
计时器顾名思义，可以计时。如何实现计时呢？想想古代的滴水计时。
计时器其实就是个计数器，只不过计时器的信号源是一个**固定频率**的时钟。
由此就实现了计时。

## 计时器的填充值计算

### 1. 首先，搞定分频,频率,周期的疑问：
分频原理，在讲`时钟`的时候已经讲了。没理解或者忘记了再去看。
**频率和周期：**
频率在物理学上的定义：单位时间内（1s）完成周期性变化的次数.
周期在物理学上的定义：完成一个**完整变化**所需要的时间
举个例子，50Hz，就是每秒完成50次完整变化。
那么，完成一次完整变化的时间（周期）就是1/50 = 0.02s

那么，2Mhz的周期就是0.5us。记住兆赫兹和千赫兹换算后的时间单位，分别是us,ms下次计算快点。

### 2. 其次，搞定计时器中断标志判断的依据**

计时器中断判的依据是，是否溢出数字的表达范围，而不是，是否等于0xFF。
其实，在计算机当中，所有的标志判断依据有如下：
*来自x86架构的CPU，MCU当中不一定都包含。*

1. 进位标志CF(Carry Flag)
1. 奇偶标志PF(Parity Flag)
1. 辅助进位标志AF(Auxiliary Carry Flag)
1. 零标志ZF(Zero Flag)
1. 符号标志SF(Sign Flag)
1. 溢出标志OF(Overflow Flag)


### 3. 最后开始计算
假设，SysCLk = 24Mhz，Timer1挂载到12T分频的时钟线上，也就是Timer1时钟频率为2Mhz。
则，每+1，时间为0.5us. 我们要计时1ms
则，1ms/0.5us = 2000(个)，也就是要累加2000次
因为，时钟是溢出中断，所以应该是65536-2000，而不是65535-2000。
如果是65535-2000会多0.5us（多加一次），这就是为什么上面要讲 计时器中断判断的依据。
也可以这样理解：65536是总次数，2000也是次数，同等类型的值相减才有意义。
则得到：0xF830，就是这个结果啦。