# ADC(模数转换)

## ADC原理

**直接ADC：逐次逼近型**

![ADC](./pages_hardware/mcustudy/img/adc_2.jpg)

多数的ADC采用逐次逼近型，易于用集成工艺实现，且能达到较高的分辨率和速度，故目前集成化A/D 芯片采用逐次逼近型者多。
如图，8位DAC按照“对分查找”的原理，产生一半的DAC的电压(0b10000000)，然后用比较器进行比较，如果大了，就变小，如果小了，就变大，直到DAC产生的模拟电压和采集到的电压差不多，结束。它比并联比较型ADC的转换速度慢，比双分积型ADC要快得多，属于中速ADC器件。
**直接ADC：并联比较型**

![ADC](./pages_hardware/mcustudy/img/adc_1.png)

将多个电阻串联在一起，采用各量级同时并行比较，各位输出码也是同时并行产生，产生0和1的二进制码，经过编码器组合形成结果，所以转换速度快。并联比较型ADC的缺点是成本高、功耗大。

**间接ADC：双积分型**

![ADC](./pages_hardware/mcustudy/img/adc_3.jpg)

如图这种转换器的原理电路，它由积分器(由集成运放A组成)、过零比较器(C)、时钟脉冲控制门（G）和计数器（FF0～FFn）等几部分组成。
**组件介绍**
(1)积分器
积分器是转换器的核心部分，它的输入端所接开关S1由定时信号Qn控制。当Qn为不同电平时，极性相反的输入电压vI和参考电压 VREF将分别加到积分器的输入端，进行两次方向相反的积分，积分时间常数τ=RC。
(2)过零比较器
过零比较器用来确定积分器的输出电压v0过零的时刻。当v0≥0时，比较器输出vC为低电平；当v0<0时，vC为高电平。比较器的输出信号接至时钟控制门(G)作为关门和开门信号。
(3)计数器和定时器
它由n+1个接成计数器的触发器FF0～FFn-1串联组成。触发器FF0～FFn-1组成n级计数器，对输入时钟脉冲CP计数，以便把与输入电压平均值成正比的时间间隔转变成数字信号输出。当计数到2n个时钟脉冲时，FF0～FFn-1均回到0态，而FFn翻转到1态，Qn=1后开关 S1从位置A转接到B。
(4)时钟脉冲控制门
时钟脉冲源标准周期Tc，作为测量时间间隔的标准时间。当vC=1时，门打开，时钟脉冲通过门加到触发器FF0的输入端。
**工作原理**
双积分ADC的基本原理是对输入模拟电压和参考电压分别进行两次积分，将输入电压平均值变成与之成正比的时间间隔，然后利用时钟脉冲和计数器测出此时间间隔，进而得到相应的数字量输出。由于该转换电路是对输入电压的平均值进行变换，所以它具有很强的抗工频干扰能力，在数字测量中得到广泛应用。

## ADC的一些概念

**位数：**
我们经常会看到4位，8位，12，14，16位ADC，这是什么意思呢？
比如我们的单片机可以采集到的电压范围为[0, 5]V，采用8位ADC，则表示把0-5V分成256份。
所以，位数代表了ADC转换的精度，位数越大，精度则越高。
所以，在计算结果的时候需要：采集电压=（ADC输出值/总份数）* 最大可采集电压

**通道：**
通道数量表示具有ADC功能的引脚的数量。
可以将ADC模块挂载到不同的引脚，来实现ADC模块的复用。

**速度：**
ADC转换速度不能太快，太快会导致精度下降。

## ADC的使用
一般过程：
1. 配置速度
2. 配置通道
3. 配置结果的左对齐还是右对齐
4. 打开ADC电源（使能）
5. 转换开始标志置1
6. 检测转换标志
7. 清空标志
8. 重复5. 6. 7.