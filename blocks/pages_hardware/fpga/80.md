# SRAM IP
SRAM具有严格的时序要求，所以在使用上也会复杂一点，需要严格遵守厂家的时序图来设计逻辑。
在使用SRAM的过程中也遇到了一些问题，这里记录一下。

## SRAM时序图及设计方法
![sram](./pages_hardware/fpga/res/sram_tq.png)
上述是一个SRAM的读写时序图。
先看CLKA，可见是**上升沿触发**。
所以我们应该选择在`下降沿`的时候去**填写地址和写入数据**。
最重要的是读取的时序。
可见，读取一个数据需要两个周期（两个下降沿）
第一个下降沿填写地址，在第二个下降沿才能读取到数据。
所以在设计一周期CPU的流水线的时候，这个填写地址和读取的时机很重要。

## FPGA时序设计思想
虽然我们脱离了比较老的手动设计时序电路的时代。
但是时序电路的设计，依然遵循最基本的状态机的思想。
**时序电路设计思想：在某状态下，做一些事情。**
在时序电路的设计当中，一定是一层又一层的If判断（或者其他比如case）包起来，判断当前的状态，然后再做相应操作。

所以就可以产生变量的用途。
一方面变量是为了**储存数据**，另一方面就是为了**储存状态**。
将状态储存起来，方便后面的判断，也会进行状态的转变。

If在FPGA里面的开销是比较小的，就是一个比较器。

在设计时序电路的时候，应当牢牢把握住，`现态`和`次态`
许多人写verilog代码依然是软件程序的思想就是因为`现态`和`次态`没理解。
组合电路是瞬间发生变化的，但凡触发了时序事件，所有的值都是`现态`，**根本访问不到次态的值**。

## FPGA触发信号
在设计时序电路的时候，触发信号是很关键的一步。
```verilog
always @(negedge tick or negedge rst_n) begin
    if(!rst_n) begin
        //CLK: rst_n
    end else begin
        //CLK: tick
    end
end
```
需要知道的一点是，当边沿触发后，其时钟信号值是触发后的值。
例如：tick是下降沿触发，则进入该事件的时候，tick的值就是0
例如：tick是上升沿触发，则进入该事件的时候，tick的值就是1
这样想：既然是边沿触发，那么只有它从1变0，或从0变1，才能判断出是边沿触发，所以值已经发生变化了。

像上述代码，具有两个时钟信号，这时候综合器就不知道该选择哪一种时钟信号。
所以需要人为告诉综合器，那么告诉它的办法就是通过上面的if else
通过if来判断一下**其中一个**的信号的值，则符合条件之内的代码，都是该时钟信号。

## FPGA输入输出位宽注意点
FPGA的输入输出有时候位宽是变化的。
例如SRAM，物理电路最大支持的字长(数据宽度)是32bits，但是我们只选用了8bits，所以会多出一些。
这些多出来的，不应该悬空，应该连接到地。
地址总线也是类似，有时候只需要[10:3]这个范围，那么多出的部分就应该填充起来。
**总之，应该保持输入输出的位宽相同，避免出错，可以所有都使用width'bxxxxx的形式。**

对于输入我们可以这样处理：
输入，但是输入的是0。
```verilog
wire gw_gnd;
assign gw_gnd = 1'b0;
```
对于输出我们可以这样处理：
提供连线，但是不用它。
```verilog
wire[23:0] space_output;
```